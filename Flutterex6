import 'package:flutter/material.dart';
import 'db_helper.dart';
import 'course.dart';
void main() {
  runApp(OnlineCourseApp());
}
class OnlineCourseApp extends StatefulWidget {
  @override
  State<OnlineCourseApp> createState() => _OnlineCourseAppState();
}
class _OnlineCourseAppState extends State<OnlineCourseApp> {
  final DBHelper dbHelper = DBHelper();
  final TextEditingController titleController = TextEditingController();
  final TextEditingController instructorController = TextEditingController();
  final TextEditingController priceController = TextEditingController();
  List<Course> courseList = [];
  double totalValue = 0.0;
  @override
  void initState() {
    super.initState();
    _refreshCourses();
  }
  Future<void> _refreshCourses() async {
    final data = await dbHelper.getCourses();
    double sum = data.fold(0, (prev, c) => prev + c.price);
    setState(() {
      courseList = data;
      totalValue = sum;
    });
  }
  Future<void> _addCourse() async {
    final title = titleController.text.trim();
    final instructor = instructorController.text.trim();
    final price = double.tryParse(priceController.text.trim()) ?? 0.0;
    if (title.isNotEmpty && instructor.isNotEmpty) {
      await dbHelper.insertCourse(Course(title: title, instructor: instructor, price: price));
      titleController.clear();
      instructorController.clear();
      priceController.clear();
      _refreshCourses();
    }
  }
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Online Course Manager'),
          backgroundColor: Colors.blueAccent,
        ),
        body: Padding(
          padding: const EdgeInsets.all(12.0),
          child: Column(
            children: [
              TextField(
                controller: titleController,
                decoration: const InputDecoration(labelText: 'Course Title'),
              ),
              TextField(
                controller: instructorController,
                decoration: const InputDecoration(labelText: 'Instructor'),
              ),
              TextField(
                controller: priceController,
                decoration: const InputDecoration(labelText: 'Price'),
                keyboardType: TextInputType.number,
              ),
              const SizedBox(height: 10),
              ElevatedButton(
                onPressed: _addCourse,
                child: const Text('Add Course'),
              ),
              const Divider(),
              Expanded(
                child: ListView.builder(
                  itemCount: courseList.length,
                  itemBuilder: (context, index) {
                    final c = courseList[index];
                    return Card(
                      elevation: 3,
                      child: ListTile(
                        title: Text(c.title),
                        subtitle: Text('Instructor: ${c.instructor}\nPrice: ₹${c.price.toStringAsFixed(2)}'),
                      ),
                    );
                  },
                ),
              ),
              Text(
                'Total Value of Courses: ₹${totalValue.toStringAsFixed(2)}',
                style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
